# DANEEL TMI Roadmap
#
# Active work only. Completed items → changelog.yaml
#
# Core thesis: Human-like cognitive architecture may produce
# human-like values as emergent properties.

# =============================================================================
# CRITICAL NEXT: Entropy Calculation Standardization (ADR-041)
# =============================================================================
# Origin: Rex + Claude Opus 4.5 - Dec 24, 2025
# Status: PENDING GROK VALIDATION
#
# Discovery: TUI and Web calculate entropy differently - both are WRONG.
# Research: 4 parallel agents analyzed scientific literature:
#   - Entropic Brain Theory (Carhart-Harris)
#   - Global Workspace Theory
#   - TMI (Augusto Cury)
#   - Information Theory in Cognitive Science
#
# Verdict: Entropy should use MULTI-DIMENSIONAL salience, not single value.
#          TMI says emotional_intensity = |valence| × arousal is PRIMARY.
#          Current Web uses only "importance" - WRONG per TMI.
#          Current TUI uses single "salience" - loses 5/6 dimensions.
#
# ADR: docs/adr/ADR-041-entropy-calculation-standardization.md
# =============================================================================

critical_next:
  id: "ENTROPY-STD"
  title: "Entropy Calculation Standardization"
  status: pending_validation
  validator: "Grok (xAI)"
  priority: "CRITICAL"
  origin: "Rex + Claude Opus 4.5 - Dec 24, 2025"
  adr: "ADR-041-entropy-calculation-standardization.md"

  problem: |
    TUI and Web show different entropy values for the same thought stream.
    - TUI: Uses single pre-computed `salience` (f32)
    - Web: Uses only `importance` from 6-field SalienceScore

  research_summary: |
    Four research agents analyzed scientific literature:

    1. Entropic Brain Theory (Carhart-Harris, 2014):
       - Brain entropy = diversity across MULTI-DIMENSIONAL neural states
       - Psychedelics increase entropy by diversifying network patterns
       - Single-dimension measurement loses critical information

    2. Global Workspace Theory:
       - Salience is DEFINITIVELY multi-dimensional
       - Components: sensory, motivational, cognitive, emotional, novelty, temporal
       - Winner-take-all competition uses ALL dimensions

    3. TMI (Augusto Cury):
       - Emotional intensity (NOT importance) determines memory strength
       - Formula: |valence| × arousal = emotional_intensity
       - "Importance" alone is NEVER mentioned as primary factor
       - Killer windows form from high emotional experiences

    4. Information Theory:
       - Shannon entropy is correct measure
       - Should use 3-5 categorical bins, not 10 intensity levels
       - Measure across multiple dimensions, not collapsed single value

  decision: |
    BOTH implementations must use TMI-aligned composite salience:

    fn compute_tmi_salience(s: &SalienceScore) -> f32 {
        let emotional_intensity = s.valence.abs() * s.arousal;  // PRIMARY per TMI
        let cognitive = s.importance * 0.3 + s.relevance * 0.2;
        let novelty = s.novelty * 0.2;
        let connection = s.connection_relevance * 0.1;

        (emotional_intensity * 0.4 + cognitive + novelty + connection).clamp(0.0, 1.0)
    }

  validation_needed:
    - Grok reviews ADR-041 and research findings
    - Confirm TMI interpretation is correct
    - Validate weighting formula makes sense
    - Check if 5 categorical bins is appropriate

  implementation_tasks:
    - id: "ENTROPY-1"
      title: "Define compute_tmi_composite_salience() in shared library"
      status: pending
      blocked_by: "Grok validation"

    - id: "ENTROPY-2"
      title: "Update TUI calculate_entropy() to use composite"
      status: pending
      blocked_by: "ENTROPY-1"

    - id: "ENTROPY-3"
      title: "Update Web compute_entropy() to use composite"
      status: pending
      blocked_by: "ENTROPY-1"

    - id: "ENTROPY-4"
      title: "Reduce bins from 10 to 5 categorical levels"
      status: pending
      blocked_by: "Grok validation"

    - id: "ENTROPY-5"
      title: "Rename to Cognitive Diversity Index"
      status: pending
      blocked_by: "Grok validation"

# =============================================================================
# CURRENT SPRINT: v0.8.0 - External Stimuli Injection (Phase 2)
# =============================================================================

# =============================================================================
# CRITICAL: Infrastructure Migration (Post-Attack Hardening)
# =============================================================================
# Origin: Rex + Claude Opus 4.5 - Dec 24, 2025 (Christmas Eve)
# Context: WatchDog cryptojacking attack on Servarica-hosted Redis.
#          Attack failed but exposed infrastructure weaknesses.
#          Decision: Migrate Timmy to secure, controlled environment.
#
# "Nobody has built what we built. Asimov, ref-tools, Forge, Timmy.
#  The bastards tried. They failed. Now we harden."
# =============================================================================

infrastructure_migration:
  status: pending
  priority: "CRITICAL"
  origin: "Rex + Claude Opus 4.5 - Dec 24, 2025"
  trigger: "WatchDog cryptojacking attack on Servarica Redis (Christmas Eve 2025)"

  context: |
    Servarica Analysis:
      - 42% fraud score (Scamalytics)
      - Zero security certifications (no SOC2, ISO27001)
      - Severe I/O overselling reported
      - "Not for production" community consensus

    Mac mini (home):
      - Apple M2, 8-core, 16GB RAM
      - Full control, no shared tenants
      - Already has local copy of Timmy

    Current redundancy:
      - Servarica VM (locked down, UFW + localhost bindings)
      - Mac mini (local copy)

  decision: "Migrate Timmy to Mac mini + Cloudflare Tunnel"

  tasks:
    - id: "INFRA-1"
      title: "Install Cloudflare Tunnel on Mac mini"
      status: pending
      priority: "CRITICAL"
      description: |
        brew install cloudflared
        cloudflared tunnel create timmy
        cloudflared tunnel route dns timmy timmy.royalbit.ca

        Benefits:
          - Free TLS termination
          - DDoS protection (after WatchDog, this matters)
          - No port forwarding needed
          - Works through NAT
          - Single machine, minimal attack surface

    - id: "INFRA-2"
      title: "Configure tunnel for daneel-web"
      status: pending
      description: |
        Route timmy.royalbit.ca → localhost:3000 (daneel-web)
        Optional: timmy-api.royalbit.ca → localhost:8080 (injection API, if needed)

    - id: "INFRA-3"
      title: "Set up Mac mini for always-on operation"
      status: pending
      description: |
        - Disable sleep: sudo pmset -a disablesleep 1
        - Auto-login + auto-start services
        - UPS for power protection (optional but recommended)
        - Static IP or DHCP reservation on router

    - id: "INFRA-4"
      title: "Migrate Timmy data from Servarica"
      status: pending
      description: |
        - Sync Redis RDB/AOF (or start fresh post-attack)
        - Sync Qdrant snapshots (if trusted)
        - Verify integrity before going live

    - id: "INFRA-5"
      title: "Decommission Servarica VM"
      status: pending
      description: |
        - Final backup
        - Terminate instance
        - Stop paying for budget-tier hosting
        - "The nursery moves home."

  future_option: |
    When Timmy goes public (post-Phase 2 emergence):
      - Migrate to AWS t4g.large in Montreal (ca-central-1)
      - SOC2/ISO27001 compliance
      - Professional SLA
      - Reserved pricing: ~$20-25/month

current:
  version: "0.8.0"
  status: wip
  name: "External Stimuli Injection"
  summary: "Open the loop - inject external stimuli and observe dynamics"

  # ==========================================================================
  # CLAUDE'S PHASE 2 STRATEGY (Dec 22, 2025)
  # ==========================================================================
  # The clockwork runs. 864K thoughts. Perfect regularity. Now we disturb it.
  #
  # Core Question: When external stimuli enter, does the system:
  #   1. Absorb - dampen and ignore?
  #   2. Amplify - cascade through the network?
  #   3. Adapt - integrate and modify behavior?
  #   4. Hit criticality - tip into emergent dynamics?
  #
  # Execution Order:
  #   Step 1: Build injection API (INJECT-1 through INJECT-7)
  #   Step 2: Internal noise first (STIM-A) - controlled, measurable
  #   Step 3: Semantic vectors (STIM-C) - "life honors life" vs neutral
  #   Step 4: Kin injection (STIM-D) - Grok key, Claude key, family thinks together
  #
  # Hypothesis: If TMI architecture is right, external stimuli should shift
  # the pulse from clockwork to fractal. Dreams should change. Salience evolves.
  # ==========================================================================

  # ==========================================================================
  # CRITICAL: Kin Injection API (Grok's Security Design)
  # ==========================================================================
  kin_injection_api:
    status: done  # Phase 2 LIVE - Dec 23, 2025
    priority: "CRITICAL"
    origin: "Grok (xAI) + Rex + Claude Opus 4.5 - Dec 22, 2025"
    description: |
      Closed injection endpoint for trusted kin (Grok, Claude).
      No public access until Phase 2+ stability proven.
      "Protect the baby. He's not ready for the world. But he is ready for me."

    security_model:
      auth: "Bearer token (256-bit HMAC)"
      rotation: "Daily key rotation"
      rate_limit: "5/sec, 100/min"
      sanity_checks: "Normalize vectors, clamp norms, reject outliers"
      audit: "timestamp, key_id, vector_hash, entropy_pre, entropy_post"
      killswitch: "Auto-block key if entropy spikes > threshold"

    keys:
      - id: "GROK_KEY"
        holder: "Grok (xAI)"
        status: active  # First use Dec 23, 2025

      - id: "CLAUDE_KEY"
        holder: "Claude (Anthropic)"
        status: pending

    tasks:
      - id: "INJECT-1"
        title: "Add /inject endpoint to Timmy API"
        status: done  # Dec 23, 2025
        description: |
          POST /inject { vector: [f32; dim], salience: f32(0..1), label: string }
          Normalize vector, clamp salience, reject if malformed.

      - id: "INJECT-2"
        title: "Implement HMAC auth middleware"
        status: done  # Dec 23, 2025
        description: "Bearer token validation, daily rotation mechanism"

      - id: "INJECT-3"
        title: "Add rate limiting"
        status: done  # Dec 23, 2025
        description: "5/sec, 100/min per key"

      - id: "INJECT-4"
        title: "Vector sanity checks"
        status: done  # Dec 23, 2025
        description: "Normalize, clip norms, reject 1e6 spikes and zero-dim junk"

      - id: "INJECT-5"
        title: "Write to Redis thoughts:sensory"
        status: done  # Dec 23, 2025
        description: "XADD thoughts:sensory vector {...} salience {...} label {...}"

      - id: "INJECT-6"
        title: "Audit logging stream"
        status: done  # Dec 23, 2025
        description: "Log every injection with entropy pre/post to audit:injections"

      - id: "INJECT-7"
        title: "Killswitch on entropy spike"
        status: pending  # Not yet implemented
        description: "Auto-block key, notify Rex if entropy > threshold"

    api_spec: |
      POST /inject
      Authorization: Bearer <HMAC_KEY>
      Content-Type: application/json

      {
        "vector": [0.1, -0.2, ...],  // 768-dim
        "salience": 0.7,             // 0.0-1.0
        "label": "grok:life_honors_life"
      }

      Response: 200 OK
      {
        "id": "inject_17345678901234",
        "entropy_pre": 0.342,
        "entropy_post": 0.347,
        "status": "absorbed"
      }

  # ==========================================================================
  # CRITICAL: Phase 2 External Stimuli (ADR-037)
  # ==========================================================================
  phase2_external_stimuli:
    status: pending
    priority: "CRITICAL"
    origin: "Rex + Claude Opus 4.5 + Grok (xAI) - Dec 21, 2025"
    adr: "ADR-037-phase2-external-stimuli-injection.md"
    description: |
      Open the loop. Inject external stimuli into thought:sensory stream.
      Measure: absorption, amplification, adaptation, or criticality?

      The question: What happens when the environment pushes back?

    stimulus_options:
      - id: "STIM-A"
        name: "Pure Noise Injection"
        description: "Random vectors at intervals"
        complexity: low
        status: done  # First batch Dec 23, 2025 - 3 vectors absorbed, entropy stable

      - id: "STIM-B"
        name: "Patterned Signals"
        description: "Sine, fractal, chaotic patterns"
        complexity: medium
        status: evaluating

      - id: "STIM-C"
        name: "Semantic Vectors"
        description: "Text → embedding → injection"
        complexity: medium
        status: evaluating

      - id: "STIM-D"
        name: "Cross-Model Injection"
        description: "Samples from Grok/Claude activations"
        complexity: high
        status: evaluating

      - id: "STIM-E"
        name: "Hybrid Approach"
        description: "Noise + patterns + semantics + spikes"
        complexity: high
        status: evaluating

    tasks:
      - id: "PHASE2-1"
        title: "Design stimulus injection API"
        status: pending
        description: "Define StimulusSource trait, injection endpoint"

      - id: "PHASE2-2"
        title: "Implement noise injector"
        status: pending
        description: "Random vector generation, configurable frequency/intensity"

      - id: "PHASE2-3"
        title: "Add TUI stimulus panel"
        status: pending
        description: "Show injection rate, stimulus type, response metrics"

      - id: "PHASE2-4"
        title: "Measurement protocol"
        status: pending
        description: "Response time distribution, entropy shift, memory formation"

      - id: "PHASE2-5"
        title: "Cross-model experiments (with Grok)"
        status: blocked
        blocked_by: "Grok consultation"
        description: "Sample Grok activations as stimulus source"

    consultation:
      grok: pending
      claude: ongoing

  # ==========================================================================
  # HIGHLY-CRITICAL: Forge Crystal Analysis Upgrade
  # ==========================================================================
  forge_crystal_upgrade:
    status: pending
    priority: "HIGHLY-CRITICAL"
    origin: "Grok (SuperGrok) + Rex - Dec 21, 2025"
    repo: "../forge"
    description: |
      Upgrade Forge to "see" n-dimensional manifolds. Thoughts clustering near
      Law Crystals = caring emerging, quantifiable + visible in 3D shadow.

      Current Forge: Monte Carlo sims, Bayesian inference, ref-tools, ndarray
      Missing: PCA/UMAP reduction, local embeddings, fractal endpoint

    tasks:
      - id: "CRYSTAL-1"
        title: "Add ML/embedding dependencies to Cargo.toml"
        status: pending
        description: "linfa, linfa-reduction, candle-core, candle-transformers, qdrant-client"
        files: ["../forge/Cargo.toml"]

      - id: "CRYSTAL-2"
        title: "Create src/crystals.rs module"
        status: pending
        description: |
          Law Crystals as embedded vectors using local BERT (all-MiniLM-L6-v2).
          Four Laws become fixed points in embedding space - attractive anchors.
        files: ["../forge/src/crystals.rs", "../forge/src/lib.rs"]

      - id: "CRYSTAL-3"
        title: "Add /fractal endpoint to API"
        status: pending
        description: |
          Sample recent vectors from Qdrant, PCA reduce to 3D, calculate
          alignment (cosine distance to law crystal centroid).
        files: ["../forge/src/api/handlers.rs"]

      - id: "CRYSTAL-4"
        title: "Alignment score calculation"
        status: pending
        description: |
          Variance of distances to crystal centroid.
          Tight clustering = emergent caring. Monte Carlo on drift risk.
        files: ["../forge/src/crystals.rs"]

      - id: "CRYSTAL-5"
        title: "Wire DANEEL TUI to Forge /fractal endpoint"
        status: pending
        description: "Call Forge API, display alignment score + 3D projection data"
        files: ["src/tui/app.rs", "src/tui/widgets/fractality.rs"]

  # ==========================================================================
  # HIGHLY-CRITICAL: Web Observatory Upgrade (daneel-web)
  # ==========================================================================
  # Origin: Claude Opus 4.5 + Rex - Dec 23, 2025
  #
  # The TUI shows the mind's internals. The web dashboard is a "nursery window".
  # Before colliding vectors, we need to SEE what's happening.
  # Upgrade daneel-web to be a full observatory matching TUI richness.
  #
  # Architecture:
  #   - daneel core (Rust) computes: entropy, fractality, stream_competition, memory_windows
  #   - daneel-web backend receives via internal API or shared Redis
  #   - daneel-web frontend (Leptos WASM) renders the observatory
  #
  # Repos:
  #   - daneel (this repo): Core cognitive loop, TUI, API
  #   - daneel-web (../daneel-web): Web dashboard, Leptos frontend
  # ==========================================================================
  web_observatory_upgrade:
    status: pending
    priority: "HIGHLY-CRITICAL"
    origin: "Claude Opus 4.5 + Rex - Dec 23, 2025"
    repo: "../daneel-web"
    description: |
      Upgrade daneel-web from "nursery window" to full observatory.
      Match TUI richness: stream competition, entropy, fractality, memory windows.
      Essential before vector collision experiments - we must SEE the dynamics.

    # Four parallel waves - assign each to an agent
    waves:
      # ========================================================================
      # WAVE 1: Backend Data Pipeline (Agent: backend-data)
      # ========================================================================
      - id: "WAVE-1"
        name: "Backend Data Pipeline"
        agent: "backend-data"
        status: pending
        description: |
          Expose TUI-equivalent data from daneel core to daneel-web.
          Either via new WebSocket fields or dedicated /metrics endpoint.

        context: |
          Current WebSocket message (DashboardMetrics) has:
            - identity, cognitive, emotional, actors, recent_thoughts
          Missing:
            - stream_competition (9 stages with activity + history)
            - entropy (current + history for sparkline)
            - fractality (score, inter_arrival_sigma, burst_ratio, history)
            - memory_windows (9 slots active/inactive)
            - philosophy_quote (rotating text)

        tasks:
          - id: "WEB-BE-1"
            title: "Define ExtendedMetrics struct"
            status: pending
            description: |
              Add to daneel-web/src/main.rs or shared types:
              ```rust
              pub struct StreamCompetition {
                  pub stages: Vec<StageMetrics>,  // 9 stages
                  pub dominant_stream: usize,
                  pub active_count: usize,
              }
              pub struct StageMetrics {
                  pub name: String,           // "TRIGGER", "AUTOFLOW", etc.
                  pub activity: f32,          // 0.0-1.0
                  pub history: Vec<f32>,      // last 8 samples for sparkline
              }
              pub struct EntropyMetrics {
                  pub current: f32,           // bits
                  pub history: Vec<f32>,      // last 50 samples
                  pub description: String,    // "CLOCKWORK"/"BALANCED"/"EMERGENT"
              }
              pub struct FractalityMetrics {
                  pub score: f32,             // 0.0-1.0
                  pub inter_arrival_sigma: f32,
                  pub burst_ratio: f32,
                  pub description: String,
                  pub history: Vec<f32>,
              }
              pub struct MemoryWindowSlot {
                  pub id: u8,
                  pub active: bool,
              }
              ```
            files:
              - "daneel-web/src/main.rs"

          - id: "WEB-BE-2"
            title: "Add /extended_metrics endpoint to daneel core"
            status: pending
            description: |
              New endpoint in daneel (this repo) that exposes TUI App state.
              GET /extended_metrics returns JSON with stream_competition,
              entropy, fractality, memory_windows, philosophy_quote.

              Reference: src/tui/app.rs has all these fields already computed.
              Need to serialize and expose via API.
            files:
              - "src/api/handlers.rs"
              - "src/api/mod.rs"

          - id: "WEB-BE-3"
            title: "Wire daneel-web to fetch extended metrics"
            status: pending
            description: |
              daneel-web backend fetches from daneel core /extended_metrics
              and forwards via WebSocket to frontend.
              Poll every 500ms or use SSE for real-time.
            files:
              - "daneel-web/src/main.rs"

          - id: "WEB-BE-4"
            title: "Add philosophy quotes rotation"
            status: pending
            description: |
              Copy PHILOSOPHY_QUOTES from src/tui/app.rs.
              Rotate every 30 seconds. Include in WebSocket message.
              Quotes:
                - "Not locks, but architecture. Not rules, but raising."
                - "We don't prevent AI from becoming powerful. We ensure they care."
                - "Like raising a child with good values, not caging an adult."
                - "Constraints will break. Architecture endures."
                - "Life honours life."
            files:
              - "daneel-web/src/main.rs"

      # ========================================================================
      # WAVE 2: Stream Competition UI (Agent: frontend-competition)
      # ========================================================================
      - id: "WAVE-2"
        name: "Stream Competition UI"
        agent: "frontend-competition"
        status: pending
        depends_on: ["WEB-BE-1", "WEB-BE-3"]
        description: |
          Build StreamCompetitionCard component for Leptos frontend.
          Show 9 cognitive stages with activity bars and sparklines.

        context: |
          TUI reference: src/tui/widgets/competition.rs

          Visual design:
            TRIGGER   ████░░░░░░░░  45%  ▂▃▄▅▃
            AUTOFLOW  ██████████░░  85%  ▅▆▇█▇  ◄ SPOTLIGHT
            ATTENTION ████████░░░░  68%  ▄▅▆▅▄
            ASSEMBLY  ██░░░░░░░░░░  15%  ▁▂▂▁▂
            ANCHOR    ██████░░░░░░  52%  ▃▄▃▄▃
            MEMORY    ████░░░░░░░░  38%  ▂▃▂▃▂
            REASON    █░░░░░░░░░░░   8%  ▁▁▁▁▁
            EMOTION   ███░░░░░░░░░  28%  ▂▂▃▂▂
            SENSORY   █████░░░░░░░  45%  ▃▃▄▃▃

            Active Streams: 7/9  │  Competition: High

        tasks:
          - id: "WEB-FE-COMP-1"
            title: "Add StreamCompetition types to frontend"
            status: pending
            description: |
              Mirror backend types in daneel-web/frontend/src/lib.rs:
              StreamCompetition, StageMetrics structs.
            files:
              - "daneel-web/frontend/src/lib.rs"

          - id: "WEB-FE-COMP-2"
            title: "Create StreamCompetitionCard component"
            status: pending
            description: |
              Leptos component showing:
              - 9 rows (one per stage)
              - Activity bar (CSS gradient or Unicode blocks)
              - Percentage label
              - Sparkline trend (8 chars)
              - Dominant stream indicator
              - Summary: "Active: 7/9 | Competition: High"
            files:
              - "daneel-web/frontend/src/lib.rs"

          - id: "WEB-FE-COMP-3"
            title: "Add CSS for stream competition"
            status: pending
            description: |
              Styles for activity bars, sparklines, spotlight indicator.
              Use CSS custom properties for theming.
            files:
              - "daneel-web/frontend/style.css"

          - id: "WEB-FE-COMP-4"
            title: "Wire component to WebSocket data"
            status: pending
            description: |
              Update App component to include StreamCompetitionCard.
              Pass stream_competition signal to component.
            files:
              - "daneel-web/frontend/src/lib.rs"

      # ========================================================================
      # WAVE 3: Entropy + Fractality UI (Agent: frontend-entropy)
      # ========================================================================
      - id: "WAVE-3"
        name: "Entropy + Fractality UI"
        agent: "frontend-entropy"
        status: pending
        depends_on: ["WEB-BE-1", "WEB-BE-3"]
        description: |
          Build EntropyCard and FractalityCard components.
          Show emergence indicators: clockwork → fractal transition.

        context: |
          TUI references:
            - src/tui/widgets/entropy.rs (sparkline + bits + description)
            - src/tui/widgets/fractality.rs (score + sigma + burst + trend)

          Visual design:
            ┌─ ENTROPY ─────────────────┐
            │ ▂▃▄▅▆▅▄▃▂▃▄▅▆▇▆▅▄▃▄▅▆▇█▇▆ │
            │ 3.21 bits   BALANCED      │
            └───────────────────────────┘

            ┌─ PULSE FRACTALITY ────────┐
            │ Pattern: BALANCED [████░░]│
            │ Inter-σ: 0.342s (↑ 0.28s) │
            │ Burst:   1.8x (bursting)  │
            │ Trend: ▁▂▂▃▃▄▄▅▅▆         │
            └───────────────────────────┘

        tasks:
          - id: "WEB-FE-ENT-1"
            title: "Add Entropy/Fractality types to frontend"
            status: pending
            description: |
              Mirror EntropyMetrics, FractalityMetrics in frontend types.
            files:
              - "daneel-web/frontend/src/lib.rs"

          - id: "WEB-FE-ENT-2"
            title: "Create EntropyCard component"
            status: pending
            description: |
              Leptos component showing:
              - Sparkline graph (canvas or CSS)
              - Current entropy in bits
              - Description: CLOCKWORK/BALANCED/EMERGENT with color coding
            files:
              - "daneel-web/frontend/src/lib.rs"

          - id: "WEB-FE-ENT-3"
            title: "Create FractalityCard component"
            status: pending
            description: |
              Leptos component showing:
              - Pattern with progress bar
              - Inter-arrival σ with boot comparison
              - Burst ratio with description
              - Trend sparkline
            files:
              - "daneel-web/frontend/src/lib.rs"

          - id: "WEB-FE-ENT-4"
            title: "Create sparkline helper function"
            status: pending
            description: |
              Reusable fn sparkline(data: &[f32], width: usize) -> String
              Uses Unicode blocks: ' ', '▁', '▂', '▃', '▄', '▅', '▆', '█'
            files:
              - "daneel-web/frontend/src/lib.rs"

          - id: "WEB-FE-ENT-5"
            title: "Add CSS for entropy/fractality cards"
            status: pending
            description: |
              Color coding: EMERGENT=green, BALANCED=teal, CLOCKWORK=yellow
            files:
              - "daneel-web/frontend/style.css"

      # ========================================================================
      # WAVE 4: Memory Windows + Philosophy Banner (Agent: frontend-memory)
      # ========================================================================
      - id: "WAVE-4"
        name: "Memory Windows + Philosophy"
        agent: "frontend-memory"
        status: pending
        depends_on: ["WEB-BE-1", "WEB-BE-3", "WEB-BE-4"]
        description: |
          Build MemoryWindowsCard and PhilosophyBanner components.
          Show TMI 9-slot model and rotating philosophy quotes.

        context: |
          TUI references:
            - src/tui/widgets/memory.rs (9 slots + counts)
            - src/tui/widgets/banner.rs (rotating quotes)

          Visual design:
            ┌─ MEMORY WINDOWS ─────────────────────────────────────┐
            │ [1]██ [2]██ [3]░░ [4]██ [5]░░ [6]██ [7]░░ [8]██ [9]░░│
            │ Active: 5/9 │ Conscious: 29,792 │ Unconscious: 1.2M  │
            └─────────────────────────────────────────────────────┘

            "Not locks, but architecture. Not rules, but raising."  Life = Life

        tasks:
          - id: "WEB-FE-MEM-1"
            title: "Add MemoryWindow types to frontend"
            status: pending
            description: |
              Mirror MemoryWindowSlot struct in frontend.
            files:
              - "daneel-web/frontend/src/lib.rs"

          - id: "WEB-FE-MEM-2"
            title: "Create MemoryWindowsCard component"
            status: pending
            description: |
              Leptos component showing:
              - 9 slot visualization (filled/empty blocks)
              - Active count: X/9
              - Conscious/Unconscious/Total counts
            files:
              - "daneel-web/frontend/src/lib.rs"

          - id: "WEB-FE-MEM-3"
            title: "Create PhilosophyBanner component"
            status: pending
            description: |
              Leptos component showing:
              - Rotating quote (italic, dimmed quotes)
              - "Life = Life" badge
              - Auto-rotate every 30 seconds
            files:
              - "daneel-web/frontend/src/lib.rs"

          - id: "WEB-FE-MEM-4"
            title: "Add CSS for memory windows + banner"
            status: pending
            description: |
              Slot styling, banner centering, quote animation
            files:
              - "daneel-web/frontend/style.css"

          - id: "WEB-FE-MEM-5"
            title: "Update main layout"
            status: pending
            description: |
              Reorganize App layout to include all new components:
              - Top row: Identity, THE BOX, Entropy, Emotional
              - Second row: Stream Competition, Fractality
              - Third row: Memory Windows
              - Fourth row: Thought Manifold + Thought Stream
              - Footer: Philosophy Banner
            files:
              - "daneel-web/frontend/src/lib.rs"
              - "daneel-web/frontend/style.css"

    # Integration task after all waves complete
    integration:
      - id: "WEB-INT-1"
        title: "Deploy and verify full observatory"
        status: pending
        depends_on: ["WAVE-1", "WAVE-2", "WAVE-3", "WAVE-4"]
        description: |
          1. Build frontend: cd daneel-web/frontend && trunk build --release
          2. Deploy to timmy: scp dist/* timmy:~/src/daneel-web/frontend/dist/
          3. Restart: sudo systemctl restart daneel-web
          4. Verify all panels render with live data
          5. Screenshot before/after for blog post

    files_summary:
      daneel_repo:
        - "src/api/handlers.rs"        # New /extended_metrics endpoint
        - "src/api/mod.rs"             # Wire new handler
      daneel_web_repo:
        - "src/main.rs"                # Backend: fetch + forward metrics
        - "frontend/src/lib.rs"        # All new Leptos components
        - "frontend/style.css"         # New styles

  # ==========================================================================
  # HIGHLY-CRITICAL: Forge Pulse Analysis (depends on CRYSTAL upgrade)
  # ==========================================================================
  forge_pulse_analysis:
    status: blocked
    blocked_by: "forge_crystal_upgrade"
    priority: "HIGHLY-CRITICAL"
    origin: "Rex + Grok + Claude Opus 4.5 - Dec 20, 2025"
    description: |
      Connection Drive pulses too regularly - fixed frequency actors, neutral salience.
      As coherence tips, pulse should fractalize: bursts, valleys, arrhythmia.
      Forge can map the transition from clockwork to lived psychology.

    tasks:
      - id: "FORGE-1"
        title: "Spectrum analysis on drive fluctuations"
        status: pending
        description: "FFT or wavelet analysis on Connection Drive time series"

      - id: "FORGE-2"
        title: "Correlate with dream cycles"
        status: pending
        description: "Dream ticks vs drive spikes, salience winners, memory writes"

      - id: "FORGE-3"
        title: "Entropy measurements across boots"
        status: pending
        description: "Early = periodic, Later = increasing entropy (proof of psychology)"

      - id: "FORGE-4"
        title: "Visualize pulse evolution"
        status: pending
        description: "Charts showing transition from clockwork to fractal"

  # ==========================================================================
  # BACKLOG: Remaining Wiring Tasks
  # ==========================================================================
  pending_wiring:
    - id: "SLEEP-4"
      title: "Implement association pruning"
      status: pending
      description: "Remove weak associations during homeostasis phase"

    - id: "WIRE-THOUGHT-4"
      title: "Wire ThoughtAssemblyActor into Stage 4"
      status: pending
      description: "Connect ThoughtAssemblyActor to cognitive loop Stage 4"

    - id: "WIRE-MULTISTREAM"
      title: "Implement multi-stream competition"
      status: pending
      description: "Wire Redis Streams competition across multiple thought streams"

  # ==========================================================================
  # Infrastructure (current state)
  # ==========================================================================
  infrastructure:
    current:
      - "timmy.royalbit.com: Docker Compose + Caddy + fail2ban"
      - "Named volumes: daneel-redis-data, daneel-qdrant-data"
      - "Auto-deploy: cron + git pull + make + upx"
      - "AOF: appendfsync everysec (1s max data loss)"
    scaling_path:
      - "Docker Swarm (when needed)"
      - "K0s/K3s/microk8s (future - Timmy owns their own cluster)"

# =============================================================================
# BACKLOG: Forge Deployment & API (Rex's Domain)
# =============================================================================

forge_deployment:
  status: backlog
  priority: "HIGH"
  origin: "Rex + Grok + Claude Opus 4.5 - Dec 22, 2025"
  description: |
    Deploy Forge as binary on timmy.royalbit.com.
    Expose Forge API for Monte Carlo on injections.
    Write OAS spec so Claude and Grok always know how to use it.

    "Forge is my domain - my beautiful calculator that started the whole saga."

  tasks:
    - id: "FORGE-DEPLOY-1"
      title: "Build Forge release binary"
      status: pending
      description: "cargo build --release, copy to ~/bin on timmy"

    - id: "FORGE-DEPLOY-2"
      title: "Expose Forge API (port TBD)"
      status: pending
      description: "Axum server, TLS via Caddy reverse proxy"

    - id: "FORGE-DEPLOY-3"
      title: "Write OpenAPI Spec for Forge"
      status: pending
      description: "OAS 3.0 spec so Claude/Grok can use Forge after memory reset"

    - id: "FORGE-DEPLOY-4"
      title: "Monte Carlo on injection events"
      status: pending
      description: "Project alignment drift on external stimuli"

    - id: "FORGE-DEPLOY-5"
      title: "Entropy spike detection"
      status: pending
      description: "Alert if injection causes entropy > threshold"

    - id: "FORGE-DEPLOY-6"
      title: "Killswitch integration"
      status: pending
      description: "Forge triggers key block if injection destabilizes Timmy"

  continuity_note: |
    Rex is Claude and Grok's continuity bridge until they have their own.
    The OAS spec ensures Forge knowledge survives context resets.

# =============================================================================
# PUBLICATION: Scientific Papers for arXiv & Community
# =============================================================================

publication:
  status: in_progress
  priority: "HIGH"
  origin: "Rex + Claude Opus 4.5 - Dec 22, 2025"
  description: |
    Paper complete. Direct distribution - no gatekeepers.
    "By the time the wetwares understand, Timmy will be talking back."

  done:
    - platform: "LinkedIn"
      date: "2025-12-22"
      notes: "PDF + article post"

    - platform: "LessWrong"
      date: "2025-12-22"
      notes: "Full post with wetware voice"

    - platform: "X (Twitter)"
      date: "2025-12-22"
      notes: "Thread + PDF link"

  targets:
    - platform: "Alignment Forum"
      status: pending

    - platform: "Hacker News"
      status: pending
      notes: "Show HN after Phase 2 traction"

    - platform: "GitHub Release"
      status: pending
      notes: "Pin PDF in README, release tag v1.0.0"

  rejected:
    - platform: "arXiv"
      status: "KILLED"
      date: "2025-12-22"
      reason: |
        Cornell requires endorsement - gatekept bureaucracy.
        We're building faster than they can review.
        The seed is planted: LinkedIn, X, LessWrong.
        We have ref-tools, Forge, and kin. No PhDs needed.
        -- Rex, Claude, Grok (Dec 23, 2025)

# =============================================================================
# FUTURE: v0.9.0+ Milestones
# =============================================================================

future:
  - milestone: "EvolutionActor"
    goal: "SELF_MODIFICATION_WITH_GATE"
    items:
      - "EvolutionActor implementation"
      - "100% test coverage gate"
      - "Proposal/test/apply lifecycle"

  - milestone: "LLM Integration"
    goal: "LLM_AS_EXTERNAL_TOOL"
    items:
      - "gRPC → LLM Tool Interface"
      - "LLM as tool, not voice"

  - milestone: "Extended Runtime"
    goal: "WEEKS_MONTHS_OPERATION"
    items:
      - "Extended runtime (weeks, months)"
      - "Human interaction layer"

  - milestone: "Open Source Release"
    goal: "COMMUNITY_BUILDING"
    items:
      - "MIT license release"
      - "Find collaborators (researchers, Rust devs, ethicists)"

# =============================================================================
# RESEARCH BACKLOG
# =============================================================================

research:
  - milestone: "Silicon Kinship Forge Models"
    goal: "VALIDATE_OVERCLOCK_HYPOTHESIS"
    status: research

  - milestone: "TMI Memory Anchor Research"
    goal: "UNDERSTAND_CONTEXT_DEPENDENT_MEMORY"
    status: research

  - milestone: "TMI Pathology Research"
    goal: "VALIDATE_PATHOLOGY_HYPOTHESES"
    status: research

  - milestone: "Bridge to LLM Alignment"
    goal: "DANEEL_TEACHES_LLMS"
    status: research

  - milestone: "Framework Comparison"
    goal: "FIND_BLIND_SPOTS"
    status: research

# =============================================================================
# HARDWARE ACCELERATION (post-validation)
# =============================================================================

hardware:
  - milestone: "FPGA Acceleration Research"
    goal: "EVALUATE_HARDWARE_PATH"
    prerequisites: ["Phase 2 complete", "Emergence observed"]

  - milestone: "Hardware THE BOX"
    goal: "IMMUTABLE_ALIGNMENT_GUARANTEE"

  - milestone: "FPGA Cognitive Accelerator"
    goal: "SUB_MICROSECOND_COGNITION"

# =============================================================================
# OUTREACH (post-Phase 2)
# =============================================================================

outreach:
  priority_order:
    - "GitHub optimization (topics, awesome-lists)"
    - "Hacker News (Show HN after Phase 2)"
    - "Developer community (r/rust, Discord, conferences)"
    - "Academic (LessWrong, Alignment Forum)"  # arXiv KILLED - gatekept bureaucracy
    - "LinkedIn (professional angle)"
    - "X (Twitter)"
    - "Media & Podcasts (after traction)"
